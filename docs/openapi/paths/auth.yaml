register:
  post:
    summary: Register a new user
    description: Create a user account with a username, email, and password.
    operationId: registerUser
    tags: [auth]
    requestBody:
      description: Registration payload.
      required: true
      content:
        application/json:
          schema:
            type: object
            required: [username, email, password]
            properties:
              username: { type: string }
              email: { type: string }
              password: { type: string, format: password }
    responses:
      "201":
        description: User created
        content:
          application/json:
            schema:
              $ref: ../openapi.yaml#/components/schemas/TokenResponse
            examples:
              register-ok:
                value:
                  username: "marc"
                  access: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
      "400":
        description: Validation error
        content:
          application/json:
            schema:
              type: object
              properties:
                error:
                  type: object
                  additionalProperties: { type: string }
              required: [error]
            examples:
              missing-fields:
                value:
                  error:
                    username: "MISSING_FIELD"
                    email: "MISSING_FIELD"
              invalid-username:
                value:
                  error:
                    username: "INVALID_USERNAME"
              invalid-email:
                value:
                  error:
                    email: "INVALID_EMAIL"
              both-invalid:
                value:
                  error:
                    username: "INVALID_USERNAME"
                    email: "INVALID_EMAIL"
      "409":
        description: Username or email already taken
        content:
          application/json:
            schema:
              type: object
              properties:
                error:
                  type: object
                  additionalProperties: { type: string }
              required: [error]
            examples:
              username-taken:
                value:
                  error:
                    username: "USERNAME_TAKEN"
              email-taken:
                value:
                  error:
                    email: "EMAIL_TAKEN"
              both-taken:
                value:
                  error:
                    username: "USERNAME_TAKEN"
                    email: "EMAIL_TAKEN"

login:
  post:
    summary: Login
    description: Authenticate a user with email and password credentials.
    operationId: loginUser
    tags: [auth]
    requestBody:
      description: Login credentials.
      required: true
      content:
        application/json:
          schema:
            type: object
            required: [email, password]
            properties:
              email: { type: string }
              password: { type: string, format: password }
    responses:
      "200":
        description: Login successful
        content:
          application/json:
            schema:
              $ref: ../openapi.yaml#/components/schemas/TokenResponse
            examples:
              login-ok:
                value:
                  username: "marc"
                  access: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
      "401":
        description: Invalid credentials
        content:
          application/json:
            schema:
              $ref: ../openapi.yaml#/components/schemas/AuthError
            examples:
              invalid-credentials:
                value:
                  error: "INVALID_CREDENTIALS"

refresh:
  post:
    summary: Refresh access token
    description: Issue a new access token using the refresh token cookie.
    operationId: refreshToken
    tags: [auth]
    responses:
      "200":
        description: New access token issued
        content:
          application/json:
            schema:
              $ref: ../openapi.yaml#/components/schemas/TokenResponse
            examples:
              refresh-ok:
                value:
                  username: "marc"
                  access: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
      "401":
        description: Refresh token invalid or expired
        content:
          application/json:
            schema:
              $ref: ../openapi.yaml#/components/schemas/AuthError
            examples:
              refresh-invalid:
                value:
                  error: "REFRESH_TOKEN_EXPIRED"
              no-refresh:
                value:
                  error: "REFRESH_TOKEN_MISSING"

logout:
  post:
    summary: Logout
    description: Clear refresh token cookie and end the session.
    operationId: logoutUser
    tags: [auth]
    responses:
      "204":
        description: Logged out successfully
      "401":
        description: Not authenticated
        content:
          application/json:
            schema:
              $ref: ../openapi.yaml#/components/schemas/AuthError
